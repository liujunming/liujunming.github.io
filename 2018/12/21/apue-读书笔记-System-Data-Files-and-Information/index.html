<!DOCTYPE html>
<html lang="zh-CN">
  <head><meta name="generator" content="Hexo 3.9.0">
    
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">


<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">

<meta name="theme-color" content="#f8f5ec">
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">



  <meta name="description" content=" apue 读书笔记-System Data Files and Information">













  <link rel="alternate" href="/atom.xml" title="L">




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=2.10.1">



<link rel="canonical" href="http://liujunming.github.io/2018/12/21/apue-读书笔记-System-Data-Files-and-Information/">



  <link rel="stylesheet" type="text/css" href="/lib/fancybox/jquery.fancybox.css">




  <link rel="stylesheet" type="text/css" href="/lib/nprogress/nprogress.min.css">



<link rel="stylesheet" type="text/css" href="/css/style.css?v=2.10.1">



  



  <script id="baidu_push">
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>









<script>
  window.config = {"leancloud":{"app_id":null,"app_key":null},"toc":true,"fancybox":true,"pjax":true};
</script>

    <title>  apue 读书笔记-System Data Files and Information - L </title>
  </head>

  <body><div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/." class="logo">L</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>

<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    
      <a href="/">
        <li class="mobile-menu-item">
          
          
            首页
          
        </li>
      </a>
    
      <a href="/archives/">
        <li class="mobile-menu-item">
          
          
            归档
          
        </li>
      </a>
    
      <a href="/categories">
        <li class="mobile-menu-item">
          
          
            分类
          
        </li>
      </a>
    
      <a href="/tags">
        <li class="mobile-menu-item">
          
          
            标签
          
        </li>
      </a>
    
      <a href="/links">
        <li class="mobile-menu-item">
          
          
            Links
          
        </li>
      </a>
    
      <a href="/books">
        <li class="mobile-menu-item">
          
          
            Books
          
        </li>
      </a>
    
      <a href="/course">
        <li class="mobile-menu-item">
          
          
            Course
          
        </li>
      </a>
    
  </ul>
</nav>

    <div class="container" id="mobile-panel">
      <header id="header" class="header"><div class="logo-wrapper">
  <a href="/." class="logo">L</a>
</div>

<nav class="site-navbar">
  
    <ul id="menu" class="menu">
      
        <li class="menu-item">
          <a class="menu-item-link" href="/">
            
            
              首页
            
          </a>
        </li>
      
        <li class="menu-item">
          <a class="menu-item-link" href="/archives/">
            
            
              归档
            
          </a>
        </li>
      
        <li class="menu-item">
          <a class="menu-item-link" href="/categories">
            
            
              分类
            
          </a>
        </li>
      
        <li class="menu-item">
          <a class="menu-item-link" href="/tags">
            
            
              标签
            
          </a>
        </li>
      
        <li class="menu-item">
          <a class="menu-item-link" href="/links">
            
            
              Links
            
          </a>
        </li>
      
        <li class="menu-item">
          <a class="menu-item-link" href="/books">
            
            
              Books
            
          </a>
        </li>
      
        <li class="menu-item">
          <a class="menu-item-link" href="/course">
            
            
              Course
            
          </a>
        </li>
      
    </ul>
  
</nav>

      </header>

      <main id="main" class="main">
        <div class="content-wrapper">
          <div id="content" class="content">
            
  
  <article class="post">
    <header class="post-header">
      <h1 class="post-title">
        
           apue 读书笔记-System Data Files and Information
        
      </h1>

      <div class="post-meta">
        <span class="post-time">
          2018-12-21
        </span>
        
        
      </div>
    </header>

    
    
  <div class="post-toc" id="post-toc">
    <h2 class="post-toc-title">文章目录</h2>
    <div class="post-toc-content">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-Password-File"><span class="toc-text">1 Password File</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-Shadow-Passwords"><span class="toc-text">2 Shadow Passwords</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-Group-File"><span class="toc-text">3 Group File</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-Supplementary-Group-IDs"><span class="toc-text">4 Supplementary Group IDs</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-Other-Data-Files"><span class="toc-text">5 Other Data Files</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-Login-Accounting"><span class="toc-text">6 Login Accounting</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-System-Identification"><span class="toc-text">7 System Identification</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-Time-and-Date-Routines"><span class="toc-text">8 Time and Date Routines</span></a></li></ol>
    </div>
  </div>



    <div class="post-content">
      
        <p>A UNIX system requires numerous data files for normal operation: the password file <code>/etc/passwd</code> and the group file <code>/etc/group</code> are two files that are frequently used by various programs. <a id="more"></a> </p>
<h2 id="1-Password-File"><a href="#1-Password-File" class="headerlink" title="1 Password File"></a>1 Password File</h2><p>The UNIX System’s password file contains the fields shown in Figure 6.1. These fields are contained in a <code>passwd</code> structure that is defined in <code>&lt;pwd.h&gt;</code>.<br><img src="/images/2018/12/35.png" alt><br>Historically, the password file has been stored in /etc/passwd and has been an ASCII file. Each line contains the fields described in Figure 6.1, separated by colons. For example, four lines from the <code>/etc/passwd</code> file on Linux could be:<br><img src="/images/2018/12/36.png" alt></p>
<ul>
<li>There is usually an entry with the user name <code>root</code>. This entry has a user ID of 0 (the superuser).</li>
<li>The encrypted password field contains a single character as a placeholder.</li>
<li>Some fields in a password file entry can be empty. If the encrypted password field is empty, it usually means that the user does not have a password. (This is not recommended.)</li>
<li>The shell field contains the name of the executable program to be used as the login shell for the user.</li>
<li>The <code>nobody</code> user name can be used to allow people to log in to a system, but with a user ID (65534) and group ID (65534) that provide no privileges. </li>
</ul>
<p>POSIX.1 defines two functions to fetch entries from the password file. These functions allow us to look up an entry given a user’s login name or numerical user ID.<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">struct passwd *<span class="title">getpwuid</span><span class="params">(<span class="keyword">uid_t</span> uid)</span></span>;</span><br><span class="line"><span class="function">struct passwd *<span class="title">getpwnam</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span> *name)</span></span>;</span><br></pre></td></tr></table></figure></p>
<p>The <code>getpwuid</code> function is used by the <code>ls</code> program to map the numerical user ID contained in an i-node into a user’s login name. The <code>getpwnam</code> function is used by the <code>login</code> program when we enter our login name.</p>
<p>These two POSIX.1 functions are fine if we want to look up either a login name or a user ID, but some programs need to go through the entire password file. Three functions can be used for this purpose: <code>getpwent</code>, <code>setpwent</code>, and <code>endpwent</code>.</p>
<h2 id="2-Shadow-Passwords"><a href="#2-Shadow-Passwords" class="headerlink" title="2 Shadow Passwords"></a>2 Shadow Passwords</h2><p>The encrypted password is a copy of the user’s password that has been put through a one-way encryption algorithm. Because this algorithm is one-way, we can’t guess the original password from the encrypted version.</p>
<p>Linux store the encrypted password in another file, often called the <em>shadow password file</em>. Minimally, this file has to contain the user name and the encrypted password. Other information relating to the password is also stored here.<br><img src="/images/2018/12/37.png" alt></p>
<h2 id="3-Group-File"><a href="#3-Group-File" class="headerlink" title="3 Group File"></a>3 Group File</h2><p>The UNIX System’s group file contains the fields shown in Figure 6.4. These fields are contained in a <code>group</code> structure that is defined in <code>&lt;grp.h&gt;</code>.<br><img src="/images/2018/12/38.png" alt>.</p>
<p>The field <code>gr_mem</code> is an array of pointers to the user names that belong to this group. This array is terminated by a null pointer.</p>
<p>We can look up either a group name or a numerical group ID with the following two functions.<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">struct group *<span class="title">getgrgid</span><span class="params">(<span class="keyword">gid_t</span> gid)</span></span>;</span><br><span class="line"><span class="function">struct group *<span class="title">getgrnam</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span> *name)</span></span>;</span><br></pre></td></tr></table></figure></p>
<p>If we want to search the entire group file, we need some additional functions.<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">struct group *<span class="title">getgrent</span><span class="params">(<span class="keyword">void</span>)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">setgrent</span><span class="params">(<span class="keyword">void</span>)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">endgrent</span><span class="params">(<span class="keyword">void</span>)</span></span>;</span><br></pre></td></tr></table></figure></p>
<h2 id="4-Supplementary-Group-IDs"><a href="#4-Supplementary-Group-IDs" class="headerlink" title="4 Supplementary Group IDs"></a>4 Supplementary Group IDs</h2><p>Not only did we belong to the group corresponding to the group ID in our password file entry, but we could also belong to as many as 16 additional groups. The file access permission checks were modified so that in addition to comparing the the file’s group ID to the process effective group ID, it was also compared to all the supplementary group IDs.<br>The advantage of using supplementary group IDs is that we no longer have to change groups explicitly. It is common to belong to multiple groups (i.e., participate in multiple projects) at the same time.</p>
<p>Three functions are provided to fetch and set the supplementary group IDs.<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">getgroups</span><span class="params">(<span class="keyword">int</span> gidsetsize, <span class="keyword">gid_t</span> grouplist[])</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">setgroups</span><span class="params">(<span class="keyword">int</span> ngroups, <span class="keyword">const</span> <span class="keyword">gid_t</span> grouplist[])</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">initgroups</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span> *username, <span class="keyword">gid_t</span> basegid)</span></span>;</span><br></pre></td></tr></table></figure></p>
<h2 id="5-Other-Data-Files"><a href="#5-Other-Data-Files" class="headerlink" title="5 Other Data Files"></a>5 Other Data Files</h2><p>We’ve discussed only two of the system’s data files so far: the password file and the group file. Numerous other files are used by UNIX systems in normal day-to-day operation. </p>
<p>Figure 6.6 shows some of these routines, which are common to UNIX systems. In this figure, we show the functions for the password files and group file, which we discussed earlier in this chapter, and some of the networking functions. There are <code>get</code>, <code>set</code>, and <code>end</code> functions for all the data files in this figure.<br><img src="/images/2018/12/39.png" alt></p>
<h2 id="6-Login-Accounting"><a href="#6-Login-Accounting" class="headerlink" title="6 Login Accounting"></a>6 Login Accounting</h2><p>Two data files provided with most UNIX systems are the <code>utmp</code> file, which keeps track of all the users currently logged in, and the <code>wtmp</code> file, which keeps track of all logins and logouts.</p>
<h2 id="7-System-Identification"><a href="#7-System-Identification" class="headerlink" title="7 System Identification"></a>7 System Identification</h2><p>POSIX.1 defines the <code>uname</code> function to return information on the current host and operating system.<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">uname</span><span class="params">(struct utsname *name)</span></span>;</span><br></pre></td></tr></table></figure></p>
<p><code>gethostname</code> function only return the name of the host.</p>
<h2 id="8-Time-and-Date-Routines"><a href="#8-Time-and-Date-Routines" class="headerlink" title="8 Time and Date Routines"></a>8 Time and Date Routines</h2><p>The <code>time</code> function returns the current time and date.<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">time_t</span> time(<span class="keyword">time_t</span> *calptr);</span><br></pre></td></tr></table></figure></p>
<p>The real-time extensions to POSIX.1 added support for multiple system clocks.A clock is identified by the <code>clockid_t</code> type. Standard values are summarized in Figure 6.8.<br><img src="/images/2018/12/41.png" alt><br>The <code>clock_gettime</code> function can be used to get the time of the specified clock. The time is returned in a <code>timespec</code> structure which expresses time values in terms of seconds and nanoseconds.<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">clock_gettime</span><span class="params">(<span class="keyword">clockid_t</span> clock_id, struct timespec *tsp)</span></span>;</span><br></pre></td></tr></table></figure></p>
<p>When the clock ID is set to <code>CLOCK_REALTIME</code>, the <code>clock_gettime</code> function provides similar functionality to the <code>time</code> function, except with <code>clock_gettime</code>, we might be able to get a higher-resolution time value if the system supports it.</p>
<p>Once we have the integer value that counts the number of seconds since the Epoch, we normally call a function to convert it to a broken-down time structure, and then call another function to generate a human-readable time and date. Figure 6.9 shows the relationships between the various time functions. (The three functions in this figure that are shown with dashed lines—<code>localtime</code>, <code>mktime</code>, and <code>strftime</code>—are all affected by the <code>TZ</code> environment variable. The dotted lines show how the calendar time is obtained from time-related structures.)<br><img src="/images/2018/12/40.png" alt><br>The two functions <code>localtime</code> and <code>gmtime</code> convert a calendar time into what’s called a broken-down time, a tm structure.<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">tm</span> &#123;</span>      <span class="comment">/* a broken-down time */</span></span><br><span class="line">    <span class="keyword">int</span>  tm_sec;   <span class="comment">/* seconds after the minute: [0 - 60] */</span></span><br><span class="line">    <span class="keyword">int</span>  tm_min;   <span class="comment">/* minutes after the hour: [0 - 59] */</span></span><br><span class="line">    <span class="keyword">int</span>  tm_hour;  <span class="comment">/* hours after midnight: [0 - 23] */</span></span><br><span class="line">    <span class="keyword">int</span>  tm_mday;  <span class="comment">/* day of the month: [1 - 31] */</span></span><br><span class="line">    <span class="keyword">int</span>  tm_mon;   <span class="comment">/* months since January: [0 - 11] */</span></span><br><span class="line">    <span class="keyword">int</span>  tm_year;  <span class="comment">/* years since 1900 */</span></span><br><span class="line">    <span class="keyword">int</span>  tm_wday;  <span class="comment">/* days since Sunday: [0 - 6] */</span></span><br><span class="line">    <span class="keyword">int</span>  tm_yday;  <span class="comment">/* days since January 1: [0 - 365] */</span></span><br><span class="line">    <span class="keyword">int</span>  tm_isdst; <span class="comment">/* daylight saving time flag: &lt;0, 0, &gt;0 */</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<p>The difference between <code>localtime</code> and <code>gmtime</code> is that the first converts the calendar time to the local time, taking into account the local time zone and daylight saving time flag, whereas the latter converts the calendar time into a broken-down time expressed as UTC.</p>
<p>The function <code>mktime</code> takes a broken-down time, expressed as a local time, and converts it into a <code>time_t</code> value.</p>
<p>The <code>strftime</code> function is a <code>printf-like</code> function for time values. It is complicated by the multitude of arguments available to customize the string it produces.</p>
<p>We mentioned that the three functions in Figure 6.9 with dashed lines were affected by the <code>TZ</code> environment variable:<code>localtime</code>,<code>mktime</code>,and <code>strftime</code>. If defined,the value of this environment variable is used by these functions instead of the default time zone. If the variable is defined to be a null string, such as <code>TZ=</code>, then UTC is normally used.</p>

      
    </div>

    
      
      



      
      
    

    
      <footer class="post-footer">
        
        
        
  <nav class="post-nav">
    
      <a class="prev" href="/2018/12/23/apue-读书笔记-Process-Environment/">
        <i class="iconfont icon-left"></i>
        <span class="prev-text nav-default">apue 读书笔记-Process Environment</span>
        <span class="prev-text nav-mobile">上一篇</span>
      </a>
    
    
      <a class="next" href="/2018/12/19/apue-读书笔记-Standard-I-O-Library/">
        <span class="next-text nav-default">apue 读书笔记-Standard I/O Library</span>
        <span class="prev-text nav-mobile">下一篇</span>
        <i class="iconfont icon-right"></i>
      </a>
    
  </nav>


      </footer>
    

  </article>


          </div>
          
  <div class="comments" id="comments">
    
      <div id="disqus_thread">
        <noscript>
          Please enable JavaScript to view the
          <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a>
        </noscript>
      </div>
    
  </div>


        </div>
      </main>

      <footer id="footer" class="footer">

  <div class="social-links">
    
      
        
          <a href="mailto:liujunming1163@gmail.com" class="iconfont icon-email" title="email"></a>
        
      
    
      
    
      
    
      
    
      
    
      
    
      
        
          <a href="https://github.com/liujunming" class="iconfont icon-github" title="github"></a>
        
      
    
      
    
      
    
      
    
      
    
      
    
      
    

    
      <a href="/atom.xml" class="iconfont icon-rss" title="rss"></a>
    
  </div>



<div class="copyright">
  <span class="power-by">
    由 <a class="hexo-link" href="https://hexo.io/">Hexo</a> 强力驱动
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    主题 - 
    <a class="theme-link" href="https://github.com/ahonn/hexo-theme-even">Even</a>
  </span>

  <span class="copyright-year">
    
    &copy; 
     
      2016 - 
    
    2021

    <span class="heart">
      <i class="iconfont icon-heart"></i>
    </span>
    <span class="author">liujunming</span>
  </span>
</div>

      </footer>

      <div class="back-to-top" id="back-to-top">
        <i class="iconfont icon-up"></i>
      </div>
    </div>

    
  
  <script type="text/javascript">
    var disqus_config = function () {
        this.page.url = 'http://liujunming.github.io/2018/12/21/apue-读书笔记-System-Data-Files-and-Information/';
        this.page.identifier = '2018/12/21/apue-读书笔记-System-Data-Files-and-Information/';
        this.page.title = ' apue 读书笔记-System Data Files and Information';
    };
    (function() {
    var d = document, s = d.createElement('script');

    s.src = '//http-liujunming-top-2.disqus.com/embed.js';

    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
    })();  
  </script>

  

  



    
  



  
  





  
    <script type="text/javascript" src="/lib/jquery/jquery.min.js"></script>
  

  
    <script type="text/javascript" src="/lib/slideout/slideout.js"></script>
  

  
    <script type="text/javascript" src="/lib/fancybox/jquery.fancybox.pack.js"></script>
  

  
    <script type="text/javascript" src="/lib/pjax/jquery.pjax.min.js"></script>
  

  
    <script type="text/javascript" src="/lib/nprogress/nprogress.min.js"></script>
  


    <script type="text/javascript" src="/js/src/even.js?v=2.10.1"></script>

  </body>
</html>
