<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    
<meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>


<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">



  <meta name="description" content="apue 读书笔记-Process Relationships"/>




  <meta name="keywords" content="linux, 读书笔记, L" />










  <link rel="alternate" href="/atom.xml" title="L">




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=2.10.1" />



<link rel="canonical" href="http://liujunming.github.io/2018/12/24/apue-读书笔记-Process-Relationships/"/>



  <link rel="stylesheet" type="text/css" href="/lib/fancybox/jquery.fancybox.css" />




  <link rel="stylesheet" type="text/css" href="/lib/nprogress/nprogress.min.css" />



<link rel="stylesheet" type="text/css" href="/css/style.css?v=2.10.1" />



  



  <script id="baidu_push">
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>









<script>
  window.config = {"leancloud":{"app_id":null,"app_key":null},"toc":true,"fancybox":true,"pjax":true};
</script>

    <title> apue 读书笔记-Process Relationships - L </title>
  </head>

  <body><div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/." class="logo">L</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>

<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    
      <a href="/">
        <li class="mobile-menu-item">
          
          
            首页
          
        </li>
      </a>
    
      <a href="/archives/">
        <li class="mobile-menu-item">
          
          
            归档
          
        </li>
      </a>
    
      <a href="/categories">
        <li class="mobile-menu-item">
          
          
            分类
          
        </li>
      </a>
    
      <a href="/tags">
        <li class="mobile-menu-item">
          
          
            标签
          
        </li>
      </a>
    
      <a href="/links">
        <li class="mobile-menu-item">
          
          
            Links
          
        </li>
      </a>
    
      <a href="/books">
        <li class="mobile-menu-item">
          
          
            Books
          
        </li>
      </a>
    
      <a href="/course">
        <li class="mobile-menu-item">
          
          
            Course
          
        </li>
      </a>
    
  </ul>
</nav>

    <div class="container" id="mobile-panel">
      <header id="header" class="header"><div class="logo-wrapper">
  <a href="/." class="logo">L</a>
</div>

<nav class="site-navbar">
  
    <ul id="menu" class="menu">
      
        <li class="menu-item">
          <a class="menu-item-link" href="/">
            
            
              首页
            
          </a>
        </li>
      
        <li class="menu-item">
          <a class="menu-item-link" href="/archives/">
            
            
              归档
            
          </a>
        </li>
      
        <li class="menu-item">
          <a class="menu-item-link" href="/categories">
            
            
              分类
            
          </a>
        </li>
      
        <li class="menu-item">
          <a class="menu-item-link" href="/tags">
            
            
              标签
            
          </a>
        </li>
      
        <li class="menu-item">
          <a class="menu-item-link" href="/links">
            
            
              Links
            
          </a>
        </li>
      
        <li class="menu-item">
          <a class="menu-item-link" href="/books">
            
            
              Books
            
          </a>
        </li>
      
        <li class="menu-item">
          <a class="menu-item-link" href="/course">
            
            
              Course
            
          </a>
        </li>
      
    </ul>
  
</nav>

      </header>

      <main id="main" class="main">
        <div class="content-wrapper">
          <div id="content" class="content">
            
  
  <article class="post">
    <header class="post-header">
      <h1 class="post-title">
        
          apue 读书笔记-Process Relationships
        
      </h1>

      <div class="post-meta">
        <span class="post-time">
          2018-12-24
        </span>
        
          <span class="post-category">
            
              <a href="/categories/linux/">linux</a>
            
          </span>
        
        
      </div>
    </header>

    
    
  <div class="post-toc" id="post-toc">
    <h2 class="post-toc-title">文章目录</h2>
    <div class="post-toc-content">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-Terminal-Logins"><span class="toc-text">1 Terminal Logins</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-Network-Logins"><span class="toc-text">2 Network Logins</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-Process-Groups"><span class="toc-text">3 Process Groups</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-Sessions"><span class="toc-text">4 Sessions</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-Controlling-Terminal"><span class="toc-text">5 Controlling Terminal</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-tcgetpgrp-tcsetpgrp-and-tcgetsid-Functions"><span class="toc-text">6 tcgetpgrp, tcsetpgrp, and tcgetsid Functions</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-Job-Control"><span class="toc-text">7 Job Control</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-Shell-Execution-of-Programs"><span class="toc-text">8 Shell Execution of Programs</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9-Orphaned-Process-Groups"><span class="toc-text">9 Orphaned Process Groups</span></a></li></ol>
    </div>
  </div>



    <div class="post-content">
      
        <p>In this chapter, we’ll look at process groups in more detail and the concept of sessions that was introduced by POSIX.1. We’ll also look at the relationship between the login shell that is invoked for us when we login and all the processes that we start from our login shell.<a id="more"></a> </p>
<h2 id="1-Terminal-Logins"><a href="#1-Terminal-Logins" class="headerlink" title="1 Terminal Logins"></a>1 Terminal Logins</h2><p>Let’s start by looking at the programs that are executed when we login to a UNIX system.</p>
<p><strong>BSD Terminal Logins</strong><br>The system administrator creates a file, usually <code>/etc/ttys</code>, that has one line per terminal device.Each line specifies the name of the device and other parameters that are passed to the <code>getty</code> program. When the system is bootstrapped, the kernel creates process ID 1, the <code>init</code> process, and it is <code>init</code> that brings the system up in multiuser mode.The <code>init</code> process reads the file <code>/etc/ttys</code> and, for every terminal device that allows a login, does a <code>fork</code> followed by an <code>exec</code> of the program <code>getty</code>. This gives us the processes shown in Figure 9.1.<br><img src="/images/2018/12/47.png" alt=""></p>
<p>It is <code>getty</code> that calls <code>open</code> for the terminal device. The terminal is opened for reading and writing.Once the device is open, file descriptors 0, 1, and 2 are set to the device. Then <code>getty</code> outputs something like <code>login:</code> and waits for us to enter our user name.<br>When we enter our user name, <code>getty</code>’s job is complete, and it then invokes the <code>login</code> program, similar to:<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">execle(<span class="string">"/bin/login"</span>, <span class="string">"login"</span>, <span class="string">"-p"</span>, username, (<span class="keyword">char</span> *)<span class="number">0</span>, envp);</span><br></pre></td></tr></table></figure></p>
<p>Figure 9.2 shows the state of these processes right after <code>login</code> has been invoked.<br><img src="/images/2018/12/48.png" alt=""><br><img src="/images/2018/12/49.png" alt=""></p>
<h2 id="2-Network-Logins"><a href="#2-Network-Logins" class="headerlink" title="2 Network Logins"></a>2 Network Logins</h2><p>The main (physical) difference between logging in to a system through a serial terminal and logging in to a system through a network is that the connection between the terminal and the computer isn’t point-to-point.</p>
<h2 id="3-Process-Groups"><a href="#3-Process-Groups" class="headerlink" title="3 Process Groups"></a>3 Process Groups</h2><p>In addition to having a process ID, each process belongs to a process group.</p>
<p>A process group is a collection of one or more processes, usually associated with the same job, that can receive signals from the same terminal. Each process group has a unique process group ID. Process group IDs are similar to process IDs: they are positive integers and can be stored in a <code>pid_t</code> data type.</p>
<p>Each process group can have a process group leader. The leader is identified by its process group ID being equal to its process ID.</p>
<p>It is possible for a process group leader to create a process group, create processes in the group, and then terminate.</p>
<p>A process joins an existing process group or creates a new process group by calling <code>setpgid</code>.</p>
<h2 id="4-Sessions"><a href="#4-Sessions" class="headerlink" title="4 Sessions"></a>4 Sessions</h2><p>A session is a collection of one or more process groups. For example, we could have the arrangement shown in Figure 9.6. Here we have three process groups in a single session.<br><img src="/images/2018/12/50.png" alt=""><br>The processes in a process group are usually placed there by a shell pipeline. For example, the arrangement shown in Figure 9.6 could have been generated by shell commands of the form<br><code>proc1 | proc2 &amp; proc3 | proc4 | proc5</code></p>
<p>A process establishes a new session by calling the <code>setsid</code> function.<br>If the calling process is not a process group leader, this function creates a new session. Three things happen.</p>
<ol>
<li>The process becomes the session leader of this new session. (A session leader is the process that creates a session.) The process is the only process in this new session.</li>
<li>The process becomes the process group leader of a new process group. The new process group ID is the process ID of the calling process.</li>
<li>The process has no controlling terminal. If the process had a controlling terminal before calling setsid, that association is broken.</li>
</ol>
<h2 id="5-Controlling-Terminal"><a href="#5-Controlling-Terminal" class="headerlink" title="5 Controlling Terminal"></a>5 Controlling Terminal</h2><p>Sessions and process groups have a few other characteristics.</p>
<ul>
<li>A session can have a single <em>controlling terminal</em>. This is usually the terminal device (in the case of a terminal login) or pseudo terminal device (in the case of a network login) on which we login.</li>
<li>The session leader that establishes the connection to the controlling terminal is called the <em>controlling process</em>.</li>
<li>The process groups within a session can be divided into a single <em>foreground process group</em> and one or more <em>background process groups</em>.</li>
<li>If a session has a controlling terminal, it has a single foreground process group and all other process groups in the session are background process groups.</li>
<li>Whenever we press the terminal’s interrupt key (often Control-C), the interrupt signal is sent to all processes in the foreground process group.</li>
<li>Whenever we press the terminal’s quit key (often Control-backslash), the quit signal is sent to all processes in the foreground process group.</li>
<li>If a modem (or network) disconnect is detected by the terminal interface, the hang-up signal is sent to the controlling process (the session leader).</li>
</ul>
<p>These characteristics are shown in Figure 9.7.<br><img src="/images/2018/12/51.png" alt=""></p>
<h2 id="6-tcgetpgrp-tcsetpgrp-and-tcgetsid-Functions"><a href="#6-tcgetpgrp-tcsetpgrp-and-tcgetsid-Functions" class="headerlink" title="6 tcgetpgrp, tcsetpgrp, and tcgetsid Functions"></a>6 <code>tcgetpgrp</code>, <code>tcsetpgrp</code>, and <code>tcgetsid</code> Functions</h2><p>We need a way to tell the kernel which process group is the foreground process group, so that the terminal device driver knows where to send the terminal input and the terminal-generated signals (Figure 9.7).</p>
<h2 id="7-Job-Control"><a href="#7-Job-Control" class="headerlink" title="7 Job Control"></a>7 Job Control</h2><p>Job control allows us to start multiple jobs (groups of processes) from a single terminal and to control which jobs can access the terminal and which jobs are run in the background. </p>
<h2 id="8-Shell-Execution-of-Programs"><a href="#8-Shell-Execution-of-Programs" class="headerlink" title="8 Shell Execution of Programs"></a>8 Shell Execution of Programs</h2><p>Let’s examine how the shells execute programs and how this relates to the concepts of process groups, controlling terminals, and sessions.</p>
<h2 id="9-Orphaned-Process-Groups"><a href="#9-Orphaned-Process-Groups" class="headerlink" title="9 Orphaned Process Groups"></a>9 Orphaned Process Groups</h2><p>We’ve mentioned that a process whose parent terminates is called an orphan and is inherited by the <code>init</code> process. We now look at entire process groups that can be orphaned and see how POSIX.1 handles this situation.</p>

      
    </div>

    
      
      



      
      
    

    
      <footer class="post-footer">
        
          <div class="post-tags">
            
              <a href="/tags/linux/">linux</a>
            
              <a href="/tags/读书笔记/">读书笔记</a>
            
          </div>
        
        
        
  <nav class="post-nav">
    
      <a class="prev" href="/2018/12/25/apue-读书笔记-Signals/">
        <i class="iconfont icon-left"></i>
        <span class="prev-text nav-default">apue 读书笔记-Signals</span>
        <span class="prev-text nav-mobile">上一篇</span>
      </a>
    
    
      <a class="next" href="/2018/12/23/apue-读书笔记-Process-Control/">
        <span class="next-text nav-default">apue 读书笔记- Process Control</span>
        <span class="prev-text nav-mobile">下一篇</span>
        <i class="iconfont icon-right"></i>
      </a>
    
  </nav>


      </footer>
    

  </article>


          </div>
          
  <div class="comments" id="comments">
    
      <div id="disqus_thread">
        <noscript>
          Please enable JavaScript to view the
          <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a>
        </noscript>
      </div>
    
  </div>


        </div>
      </main>

      <footer id="footer" class="footer">

  <div class="social-links">
    
      
        
          <a href="mailto:liujunming1163@gmail.com" class="iconfont icon-email" title="email"></a>
        
      
    
      
    
      
    
      
    
      
    
      
    
      
        
          <a href="https://github.com/liujunming" class="iconfont icon-github" title="github"></a>
        
      
    
      
    
      
    
      
    
      
    
      
    
      
    

    
      <a href="/atom.xml" class="iconfont icon-rss" title="rss"></a>
    
  </div>



<div class="copyright">
  <span class="power-by">
    由 <a class="hexo-link" href="https://hexo.io/">Hexo</a> 强力驱动
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    主题 - 
    <a class="theme-link" href="https://github.com/ahonn/hexo-theme-even">Even</a>
  </span>

  <span class="copyright-year">
    
    &copy; 
     
      2016 - 
    
    2018

    <span class="heart">
      <i class="iconfont icon-heart"></i>
    </span>
    <span class="author">liujunming</span>
  </span>
</div>

      </footer>

      <div class="back-to-top" id="back-to-top">
        <i class="iconfont icon-up"></i>
      </div>
    </div>

    
  
  <script type="text/javascript">
    var disqus_config = function () {
        this.page.url = 'http://liujunming.github.io/2018/12/24/apue-读书笔记-Process-Relationships/';
        this.page.identifier = '2018/12/24/apue-读书笔记-Process-Relationships/';
        this.page.title = 'apue 读书笔记-Process Relationships';
    };
    (function() {
    var d = document, s = d.createElement('script');

    s.src = '//http-liujunming-top-2.disqus.com/embed.js';

    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
    })();  
  </script>

  

  



    
  



  
  





  
    <script type="text/javascript" src="/lib/jquery/jquery.min.js"></script>
  

  
    <script type="text/javascript" src="/lib/slideout/slideout.js"></script>
  

  
    <script type="text/javascript" src="/lib/fancybox/jquery.fancybox.pack.js"></script>
  

  
    <script type="text/javascript" src="/lib/pjax/jquery.pjax.min.js"></script>
  

  
    <script type="text/javascript" src="/lib/nprogress/nprogress.min.js"></script>
  


    <script type="text/javascript" src="/js/src/even.js?v=2.10.1"></script>

  </body>
</html>
