<!DOCTYPE html>
<html lang="zh-CN">
  <head><meta name="generator" content="Hexo 3.9.0">
    
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">


<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">

<meta name="theme-color" content="#f8f5ec">
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">



  <meta name="description" content="Linux kernel uapi header file">




  <meta name="keywords" content="Kernel, L">










  <link rel="alternate" href="/atom.xml" title="L">




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=2.10.1">



<link rel="canonical" href="http://liujunming.github.io/2022/02/05/Linux-kernel-uapi-header-file/">



  <link rel="stylesheet" type="text/css" href="/lib/fancybox/jquery.fancybox.css">




  <link rel="stylesheet" type="text/css" href="/lib/nprogress/nprogress.min.css">



<link rel="stylesheet" type="text/css" href="/css/style.css?v=2.10.1">



  



  <script id="baidu_push">
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>









<script>
  window.config = {"leancloud":{"app_id":null,"app_key":null},"toc":true,"fancybox":true,"pjax":true};
</script>

    <title> Linux kernel uapi header file - L </title>
  </head>

  <body><div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/." class="logo">L</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>

<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    
      <a href="/">
        <li class="mobile-menu-item">
          
          
            首页
          
        </li>
      </a>
    
      <a href="/archives/">
        <li class="mobile-menu-item">
          
          
            归档
          
        </li>
      </a>
    
      <a href="/categories">
        <li class="mobile-menu-item">
          
          
            分类
          
        </li>
      </a>
    
      <a href="/tags">
        <li class="mobile-menu-item">
          
          
            标签
          
        </li>
      </a>
    
      <a href="/links">
        <li class="mobile-menu-item">
          
          
            Links
          
        </li>
      </a>
    
      <a href="/books">
        <li class="mobile-menu-item">
          
          
            Books
          
        </li>
      </a>
    
      <a href="/course">
        <li class="mobile-menu-item">
          
          
            Course
          
        </li>
      </a>
    
  </ul>
</nav>

    <div class="container" id="mobile-panel">
      <header id="header" class="header"><div class="logo-wrapper">
  <a href="/." class="logo">L</a>
</div>

<nav class="site-navbar">
  
    <ul id="menu" class="menu">
      
        <li class="menu-item">
          <a class="menu-item-link" href="/">
            
            
              首页
            
          </a>
        </li>
      
        <li class="menu-item">
          <a class="menu-item-link" href="/archives/">
            
            
              归档
            
          </a>
        </li>
      
        <li class="menu-item">
          <a class="menu-item-link" href="/categories">
            
            
              分类
            
          </a>
        </li>
      
        <li class="menu-item">
          <a class="menu-item-link" href="/tags">
            
            
              标签
            
          </a>
        </li>
      
        <li class="menu-item">
          <a class="menu-item-link" href="/links">
            
            
              Links
            
          </a>
        </li>
      
        <li class="menu-item">
          <a class="menu-item-link" href="/books">
            
            
              Books
            
          </a>
        </li>
      
        <li class="menu-item">
          <a class="menu-item-link" href="/course">
            
            
              Course
            
          </a>
        </li>
      
    </ul>
  
</nav>

      </header>

      <main id="main" class="main">
        <div class="content-wrapper">
          <div id="content" class="content">
            
  
  <article class="post">
    <header class="post-header">
      <h1 class="post-title">
        
          Linux kernel uapi header file
        
      </h1>

      <div class="post-meta">
        <span class="post-time">
          2022-02-05
        </span>
        
          <span class="post-category">
            
              <a href="/categories/Kernel/">Kernel</a>
            
          </span>
        
        
      </div>
    </header>

    
    
  <div class="post-toc" id="post-toc">
    <h2 class="post-toc-title">文章目录</h2>
    <div class="post-toc-content">
      <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-Introduction"><span class="toc-text">1. Introduction</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-Where"><span class="toc-text">2. Where</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-What"><span class="toc-text">3. What</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-Benefit"><span class="toc-text">4. Benefit</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-How"><span class="toc-text">5. How</span></a></li></ol>
    </div>
  </div>



    <div class="post-content">
      
        <p>What’s in include/uapi of kernel source project?<a id="more"></a></p>
<h3 id="1-Introduction"><a href="#1-Introduction" class="headerlink" title="1. Introduction"></a>1. Introduction</h3><p>The <code>uapi</code> folder is supposed to contain the user space API of the kernel. Then upon kernel installation, the <code>uapi</code> include files become the top level <code>/usr/include/linux/</code> files. </p>
<p>The other headers in theory are then private to the kernel. This allow clean separation of the user-visible and kernel-only structures which previously were intermingled in a single header file.</p>
<blockquote>
<p>the “uapi” include file cleanups. The idea is that the stuff exported to user space should now be found under include/uapi and arch/$(ARCH)/include/uapi.</p>
</blockquote>
<h3 id="2-Where"><a href="#2-Where" class="headerlink" title="2. Where"></a>2. Where</h3><p><a href="https://elixir.bootlin.com/linux/v5.17-rc1/source/include/uapi" target="_blank" rel="noopener">include/uapi</a> corresponding to <code>/user/include/linux/</code> files.</p>
<p><a href="https://elixir.bootlin.com/linux/v5.17-rc1/source/arch/x86/include/uapi/asm" target="_blank" rel="noopener">arch/x86/include/uapi/asm</a> corresponding to <code>/usr/include/x86_64-linux-gnu/asm</code> files.</p>
<h3 id="3-What"><a href="#3-What" class="headerlink" title="3. What"></a>3. What</h3><p>Split out the user-space API content of the kernel header files in the <code>include</code> and <code>arch/xxxxxx/include</code> directories, placing that content into corresponding headers created in new uapi/ subdirectories that reside under each of the original directories. </p>
<h3 id="4-Benefit"><a href="#4-Benefit" class="headerlink" title="4. Benefit"></a>4. Benefit</h3><ul>
<li>simplifies and reduces the size of the kernel-only headers</li>
<li>simplifies the complex interdependencies between headers that are [currently] partly exported to userspace</li>
<li>There is one other benefit of the UAPI split that may be of particular interest to the wider Linux ecosystem. By placing all of the user-space API-related definitions into files dedicated solely to that task, it becomes easier to track changes to the APIs that the kernel presents to user space. In the first instance, these changes can be discovered by scanning the git logs for changes in files under the <code>uapi/</code> subdirectories. Easing the task of tracking user-space APIs would help many other parts of the ecosystem, for example, C library maintainers, scripting language projects that maintain language bindings for the user-space API, testing projects such as <a href="http://ltp.sourceforge.net/" target="_blank" rel="noopener">LTP</a>, documentation projects such as <a href="http://www.kernel.org/doc/man-pages/" target="_blank" rel="noopener">man-pages</a>, and perhaps even LWN editors preparing summaries of changes in the merge window that occurs at the start of each kernel release cycle.</li>
</ul>
<h3 id="5-How"><a href="#5-How" class="headerlink" title="5. How"></a>5. How</h3><p>The task of disintegrating each of the header files into two pieces is in principle straightforward. In the general case, each header file has the following form:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* Header comments (copyright, etc.) */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> _XXXXXX_H     <span class="comment">/* Guard macro preventing double inclusion */</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> _XXXXXX_H</span></span><br><span class="line"></span><br><span class="line">[User-space definitions]</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> __KERNEL__</span></span><br><span class="line"></span><br><span class="line">[Kernel-space definitions]</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">/* __KERNEL__ */</span></span></span><br><span class="line"></span><br><span class="line">[User-space definitions]</span><br><span class="line">  </span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">/* End prevent double inclusion */</span></span></span><br></pre></td></tr></table></figure>
<p>Each of the above parts may or may not be present in individual header files, and there may be multiple blocks governed by <code>#ifdef __KERNEL__</code> preprocessor directives.</p>
<p>The part of this file that is of most interest is the code that falls inside the outermost <code>#ifndef</code> block that prevents double inclusion of the header file. <em>[User-space definitions]</em> should move to the corresponding <code>uapi/</code> header file. The content inside the <code>#ifdef __KERNEL__</code> block remains in the original header file, but the <code>#ifdef __KERNEL__</code> and its accompanying <code>#endif</code> are removed.</p>
<p>A copy of the header comments remains in the original header file, and is duplicated in the new <code>uapi/</code> header file. In addition, a <code>#include</code> directive needs to be added to the original header file so that it includes the new <code>uapi/</code> header file, and of course a suitable <code>git commit</code> message needs to be supplied for the change.</p>
<p>The goal is to modify the original header file to look like this:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* Header comments (copyright, etc.) */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> _XXXXXX_H     <span class="comment">/* Guard macro preventing double inclusion */</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> _XXXXXX_H</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;include/uapi/path/to/header.h&gt;</span></span></span><br><span class="line"></span><br><span class="line">[Kernel-space definitions]</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">/* End prevent double inclusion */</span></span></span><br></pre></td></tr></table></figure>
<p>The corresponding <code>uapi/</code> header file will look like this:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* Header comments (copyright, etc.) */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> _UAPI__XXXXXX_H     <span class="comment">/* Guard macro preventing double inclusion */</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> _UAPI__XXXXXX_H</span></span><br><span class="line"></span><br><span class="line">[User-space definitions]</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">/* End prevent double inclusion */</span></span></span><br></pre></td></tr></table></figure>
<hr>
<p>参考资料:</p>
<ol>
<li><a href="https://lwn.net/Articles/507794/" target="_blank" rel="noopener">The UAPI header file split</a></li>
<li><a href="https://lwn.net/Articles/507832/" target="_blank" rel="noopener">UAPI header file split</a></li>
<li><a href="https://stackoverflow.com/questions/18858190/whats-in-include-uapi-of-kernel-source-project" target="_blank" rel="noopener">What’s in include/uapi of kernel source project</a></li>
</ol>

      
    </div>

    
      
      



      
      
    

    
      <footer class="post-footer">
        
          <div class="post-tags">
            
              <a href="/tags/Kernel/">Kernel</a>
            
          </div>
        
        
        
  <nav class="post-nav">
    
    
      <a class="next" href="/2022/01/24/FPU-virtualization-in-KVM/">
        <span class="next-text nav-default">FPU virtualization in KVM</span>
        <span class="prev-text nav-mobile">下一篇</span>
        <i class="iconfont icon-right"></i>
      </a>
    
  </nav>


      </footer>
    

  </article>


          </div>
          
  <div class="comments" id="comments">
    
      <div id="disqus_thread">
        <noscript>
          Please enable JavaScript to view the
          <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a>
        </noscript>
      </div>
    
  </div>


        </div>
      </main>

      <footer id="footer" class="footer">

  <div class="social-links">
    
      
        
          <a href="mailto:liujunming1163@gmail.com" class="iconfont icon-email" title="email"></a>
        
      
    
      
    
      
    
      
    
      
    
      
    
      
        
          <a href="https://github.com/liujunming" class="iconfont icon-github" title="github"></a>
        
      
    
      
    
      
    
      
    
      
    
      
    
      
    

    
      <a href="/atom.xml" class="iconfont icon-rss" title="rss"></a>
    
  </div>



<div class="copyright">
  <span class="power-by">
    由 <a class="hexo-link" href="https://hexo.io/">Hexo</a> 强力驱动
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    主题 - 
    <a class="theme-link" href="https://github.com/ahonn/hexo-theme-even">Even</a>
  </span>

  <span class="copyright-year">
    
    &copy; 
     
      2016 - 
    
    2022

    <span class="heart">
      <i class="iconfont icon-heart"></i>
    </span>
    <span class="author">liujunming</span>
  </span>
</div>

      </footer>

      <div class="back-to-top" id="back-to-top">
        <i class="iconfont icon-up"></i>
      </div>
    </div>

    
  
  <script type="text/javascript">
    var disqus_config = function () {
        this.page.url = 'http://liujunming.github.io/2022/02/05/Linux-kernel-uapi-header-file/';
        this.page.identifier = '2022/02/05/Linux-kernel-uapi-header-file/';
        this.page.title = 'Linux kernel uapi header file';
    };
    (function() {
    var d = document, s = d.createElement('script');

    s.src = '//http-liujunming-top-2.disqus.com/embed.js';

    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
    })();  
  </script>

  

  



    
  



  
  





  
    <script type="text/javascript" src="/lib/jquery/jquery.min.js"></script>
  

  
    <script type="text/javascript" src="/lib/slideout/slideout.js"></script>
  

  
    <script type="text/javascript" src="/lib/fancybox/jquery.fancybox.pack.js"></script>
  

  
    <script type="text/javascript" src="/lib/pjax/jquery.pjax.min.js"></script>
  

  
    <script type="text/javascript" src="/lib/nprogress/nprogress.min.js"></script>
  


    <script type="text/javascript" src="/js/src/even.js?v=2.10.1"></script>

  </body>
</html>
